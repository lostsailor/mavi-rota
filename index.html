<!DOCTYPE html>
<html lang="tr">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WKVTSR6J8R"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-WKVTSR6J8R');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mavi Rota | Akƒ±llƒ± Seyir Sistemi</title>
    <meta name="theme-color" content="#0f172a">

    <style>
        /* --- MODERN & AGRESƒ∞F TASARIM --- */
        :root {
            --bg-dark: #0f172a;
            --glass: rgba(255, 255, 255, 0.08);
            --border: rgba(255, 255, 255, 0.15);
            --text: #f1f5f9;
            --accent: #0ea5e9; /* Sky Blue */
            --danger: #ef4444; /* Red */
            --safe: #10b981; /* Green */
            --alarm-anim: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
            color: var(--text);
            margin: 0; padding: 0;
            min-height: 100vh;
            padding-bottom: 100px;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }

        /* Header */
        header { text-align: center; padding: 20px 0; }
        h1 { 
            font-size: 2.2rem; margin: 0; 
            background: linear-gradient(to right, #38bdf8, #818cf8); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; 
        }

        /* Cards */
        .card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-weight: bold; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }

        /* --- VURUCU √ñZELLƒ∞K: RADAR EKRANI --- */
        .radar-screen {
            width: 100%; height: 200px;
            background: radial-gradient(circle, rgba(16,185,129,0.1) 0%, rgba(15,23,42,0.8) 70%);
            border: 2px dashed var(--border);
            border-radius: 50%;
            position: relative;
            margin: 20px auto;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }
        
        /* Tekne ƒ∞konu */
        .boat-icon { font-size: 2rem; position: relative; z-index: 2; transition: 0.5s; }
        
        /* Radar Dalgasƒ± Animasyonu */
        .radar-pulse {
            position: absolute; width: 100%; height: 100%;
            border-radius: 50%; border: 1px solid var(--safe);
            animation: radar-spin 4s infinite linear;
            opacity: 0.3;
        }
        @keyframes radar-spin { 0% { transform: scale(0.1); opacity: 1; } 100% { transform: scale(1); opacity: 0; } }

        /* ALARM DURUMU (Kƒ±rmƒ±zƒ± Yanƒ±p S√∂nme) */
        body.alarm-active { animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 
            0% { background-color: #0f172a; } 
            50% { background-color: #450a0a; } 
            100% { background-color: #0f172a; } 
        }
        
        .status-text { text-align: center; font-size: 0.9rem; color: #94a3b8; font-family: monospace; margin-top: 10px; }
        .drift-value { font-size: 2.5rem; font-weight: 900; text-align: center; margin: 10px 0; color: var(--text); }
        .drift-label { text-align: center; font-size: 0.8rem; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }

        /* --- INPUTS & BUTTONS --- */
        input, select {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            color: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; font-size: 1rem; box-sizing: border-box;
        }
        
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            font-weight: bold; font-size: 1rem; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        
        .btn-primary { background: var(--accent); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-safe { background: var(--safe); color: #064e3b; }
        .btn-stop { background: transparent; border: 2px solid var(--danger); color: var(--danger); }

        /* --- BOTTOM NAV --- */
        .nav-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.95); border: 1px solid var(--border);
            padding: 12px 30px; border-radius: 50px; display: flex; gap: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 100; backdrop-filter: blur(10px);
        }
        .nav-icon { font-size: 1.5rem; text-decoration: none; transition: 0.2s; opacity: 0.6; }
        .nav-icon.active, .nav-icon:hover { opacity: 1; transform: scale(1.2); }

    </style>
</head>
<body>

<div class="container">
    <header id="home">
        <h1>MAVƒ∞ ROTA</h1>
        <div style="color:#64748b; font-size:0.8rem; letter-spacing:2px;">ULTIMATE SAILING TOOL</div>
    </header>

    <div class="card" id="anchor-watch" style="border-color: var(--safe);">
        <div class="card-header">
            <span class="card-title" style="color:var(--safe)">‚öì DEMƒ∞R TARAMA ALARMI</span>
            <div class="live-indicator" style="width:10px; height:10px; background:var(--safe); border-radius:50%;"></div>
        </div>

        <div class="radar-screen" id="radar">
            <div class="radar-pulse" id="radarPulse"></div>
            <div class="boat-icon">‚õµ</div>
        </div>

        <div class="drift-value" id="distDisplay">0 <span style="font-size:1rem; color:#64748b">m</span></div>
        <div class="drift-label">√áAPADAN UZAKLIK</div>

        <div style="margin-top: 20px; display:grid; gap:10px;">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="number" id="radiusInput" value="40" placeholder="Yarƒ±√ßap (m)">
                <button class="btn btn-safe" id="anchorBtn" onclick="toggleAnchorWatch()">DEMƒ∞R AT</button>
            </div>
            <div id="statusMsg" class="status-text">Alarm Kapalƒ± - G√ºvenli Uyku Modu</div>
            <button class="btn btn-stop" id="stopAlarmBtn" onclick="stopSiren()" style="display:none;">üö® Sƒ∞RENƒ∞ DURDUR</button>
        </div>
    </div>

    <div class="card" id="cockpit">
        <div class="card-header"><span class="card-title">üõ∞Ô∏è SEYƒ∞R KOKPƒ∞Tƒ∞</span></div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; text-align:center;">
            <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:12px;">
                <div style="font-size:2rem; font-weight:bold;" id="sog">0.0</div>
                <div style="font-size:0.7rem; color:#94a3b8;">HIZ (KN)</div>
            </div>
            <div style="background:rgba(0,0,0,0.2); padding:15px; border-radius:12px;">
                <div style="font-size:2rem; font-weight:bold;" id="cog">---</div>
                <div style="font-size:0.7rem; color:#94a3b8;">ROTA (COG)</div>
            </div>
        </div>
        <div style="text-align:center; font-family:monospace; margin-top:15px; color:#94a3b8;" id="coords">
            GPS Bekleniyor...
        </div>
    </div>

    <div class="card" id="mayday" style="border-color: var(--danger);">
        <div class="card-header"><span class="card-title" style="color:var(--danger)">üÜò ACƒ∞L DURUM (MAYDAY)</span></div>
        <select id="distressType">
            <option>BATMA TEHLƒ∞KESƒ∞ (SINKING)</option>
            <option>YANGIN (FIRE)</option>
            <option>KARAYA OTURMA (GROUNDING)</option>
            <option>TIBBƒ∞ ACƒ∞L (MEDICAL)</option>
        </select>
        <button class="btn btn-danger" onclick="genMayday()">METNƒ∞ OLU≈ûTUR</button>
        <div id="maydayOut" style="display:none; background:rgba(239,68,68,0.1); padding:15px; margin-top:10px; border-radius:8px; font-family:monospace; color:#fca5a5; white-space:pre-line;"></div>
    </div>

    <div class="card" id="tools">
        <div class="card-header"><span class="card-title">üßÆ HESAPLAMALAR</span></div>
        
        <div style="margin-bottom:20px; border-bottom:1px solid var(--border); padding-bottom:20px;">
            <label style="font-size:0.8rem; color:#94a3b8;">KALOMA (Zƒ∞NCƒ∞R)</label>
            <div style="display:flex; gap:10px; margin-top:5px;">
                <input type="number" id="depth" placeholder="Derinlik (m)">
                <button class="btn btn-primary" style="width:auto;" onclick="calcScope()">HESAPLA</button>
            </div>
            <div id="scopeRes" style="font-weight:bold; color:var(--accent); margin-top:5px;"></div>
        </div>

        <div>
            <label style="font-size:0.8rem; color:#94a3b8;">TEKNE Bƒ∞LGƒ∞LERƒ∞</label>
            <input type="text" id="boatName" placeholder="Tekne Adƒ±" onchange="save()">
        </div>
    </div>
    
    <div style="height:50px;"></div> </div>

<div class="nav-dock">
    <a href="#anchor-watch" class="nav-icon">‚öì</a>
    <a href="#cockpit" class="nav-icon">üß≠</a>
    <a href="#mayday" class="nav-icon">üÜò</a>
    <a href="#tools" class="nav-icon">‚öôÔ∏è</a>
</div>

<script>
    /* --- GLOBAL DEƒûƒ∞≈ûKENLER --- */
    let watchID = null;
    let anchorPos = null; // {lat, lon}
    let isAnchorActive = false;
    let audioCtx = null;
    let oscillator = null;

    /* --- 1. GPS & KOKPƒ∞T MANTIƒûI --- */
    // Sayfa a√ßƒ±lƒ±nca GPS izlemeyi ba≈ülat (Eƒüer izin varsa)
    function startGPS() {
        if("geolocation" in navigator) {
            watchID = navigator.geolocation.watchPosition(updatePos, handleError, {
                enableHighAccuracy: true, 
                timeout: 5000, 
                maximumAge: 0
            });
        }
    }

    function updatePos(pos) {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;
        const spd = pos.coords.speed ? (pos.coords.speed * 1.94384).toFixed(1) : "0.0";
        const cog = pos.coords.heading ? pos.coords.heading.toFixed(0) : "---";

        // Kokpit G√ºncelle
        document.getElementById('sog').innerText = spd;
        document.getElementById('cog').innerText = cog;
        document.getElementById('coords').innerText = lat.toFixed(5) + " / " + lon.toFixed(5);

        // Demir Alarmƒ± Kontrol√º
        if (isAnchorActive && anchorPos) {
            const dist = getDistance(anchorPos.lat, anchorPos.lon, lat, lon);
            document.getElementById('distDisplay').innerHTML = dist.toFixed(1) + " <span style='font-size:1rem; color:#64748b'>m</span>";
            
            const limit = parseFloat(document.getElementById('radiusInput').value) || 40;
            
            // G√∂rsel G√ºncelleme (Renk Deƒüi≈üimi)
            if(dist > limit) {
                triggerAlarm(dist);
            } else {
                stopSiren(); // G√ºvenli b√∂lgeye d√∂nerse sus
                document.getElementById('radar').style.borderColor = "var(--safe)";
                document.body.classList.remove('alarm-active');
            }
        }
    }
    
    function handleError(err) { console.log("GPS Hatasƒ±: " + err.message); }

    /* --- 2. DEMƒ∞R ALARMI MANTIƒûI (KRƒ∞Tƒ∞K) --- */
    function toggleAnchorWatch() {
        const btn = document.getElementById('anchorBtn');
        const status = document.getElementById('statusMsg');

        if (!isAnchorActive) {
            // Alarmƒ± Ba≈ülat
            if (!navigator.geolocation) { alert("GPS Yok!"); return; }
            
            // O anki konumu al ve "√áapa" olarak i≈üaretle
            navigator.geolocation.getCurrentPosition(pos => {
                anchorPos = { lat: pos.coords.latitude, lon: pos.coords.longitude };
                isAnchorActive = true;
                btn.innerText = "ALARI KAPAT";
                btn.className = "btn btn-stop";
                status.innerText = "‚úÖ ƒ∞ZLEME AKTƒ∞F - Uyuyabilirsiniz";
                status.style.color = "var(--safe)";
                document.getElementById('radarPulse').style.animationDuration = "2s"; // Hƒ±zlandƒ±r
                
                // GPS ƒ∞zlemeyi Garantiye Al
                if(!watchID) startGPS();
            });

        } else {
            // Alarmƒ± Durdur
            isAnchorActive = false;
            anchorPos = null;
            btn.innerText = "DEMƒ∞R AT";
            btn.className = "btn btn-safe";
            status.innerText = "Alarm Kapalƒ±";
            status.style.color = "#94a3b8";
            stopSiren();
            document.getElementById('distDisplay').innerHTML = "0 <span style='font-size:1rem'>m</span>";
            document.body.classList.remove('alarm-active');
        }
    }

    // Haversine Form√ºl√º (ƒ∞ki GPS noktasƒ± arasƒ± mesafe - Metre cinsinden)
    function getDistance(lat1, lon1, lat2, lon2) {
        const R = 6371e3; // D√ºnya yarƒ±√ßapƒ± (metre)
        const œÜ1 = lat1 * Math.PI/180;
        const œÜ2 = lat2 * Math.PI/180;
        const ŒîœÜ = (lat2-lat1) * Math.PI/180;
        const ŒîŒª = (lon2-lon1) * Math.PI/180;

        const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) +
                  Math.cos(œÜ1) * Math.cos(œÜ2) *
                  Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
    }

    /* --- 3. SESLƒ∞ ALARM (AUDIO CONTEXT) --- */
    // Tarayƒ±cƒ±da ses dosyasƒ± olmadan siren √ßalmak i√ßin osilat√∂r kullanƒ±yoruz.
    function triggerAlarm(dist) {
        document.body.classList.add('alarm-active');
        document.getElementById('statusMsg').innerText = `‚ö†Ô∏è Dƒ∞KKAT! TARAMA VAR (${dist.toFixed(1)}m)`;
        document.getElementById('statusMsg').style.color = "var(--danger)";
        document.getElementById('stopAlarmBtn').style.display = 'block';
        document.getElementById('radar').style.borderColor = "var(--danger)";

        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        if (!oscillator) {
            oscillator = audioCtx.createOscillator();
            oscillator.type = 'sawtooth'; // Rahatsƒ±z edici ses tipi
            oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
            
            // Siren efekti (Frekans mod√ºlasyonu)
            oscillator.frequency.linearRampToValueAtTime(1000, audioCtx.currentTime + 0.5);
            
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = 1.0; // Maksimum ses
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            
            // Sireni d√∂ng√ºye sok (Basit√ße osilat√∂r√º s√ºrekli deƒüi≈ütirerek)
            // Not: Basit versiyonu s√ºrekli √ßalar.
        }
    }

    function stopSiren() {
        if (oscillator) {
            oscillator.stop();
            oscillator = null;
        }
        document.getElementById('stopAlarmBtn').style.display = 'none';
    }

    /* --- 4. Dƒ∞ƒûER FONKSƒ∞YONLAR --- */
    function calcScope() {
        const d = parseFloat(document.getElementById('depth').value);
        if(d) document.getElementById('scopeRes').innerText = "Zincir: " + ((d+1.5)*5).toFixed(1) + "m (5x)";
    }

    function genMayday() {
        const n = localStorage.getItem('boatName') || "[TEKNE]";
        const gps = document.getElementById('coords').innerText;
        const type = document.getElementById('distressType').value;
        const txt = `MAYDAY MAYDAY MAYDAY\nBURASI ${n}\nMEVKƒ∞: ${gps}\nDURUM: ${type}\nYARDIM ƒ∞STƒ∞YORUZ.`;
        document.getElementById('maydayOut').style.display='block';
        document.getElementById('maydayOut').innerText = txt;
    }

    function save() { localStorage.setItem('boatName', document.getElementById('boatName').value); }
    window.onload = function() { 
        if(localStorage.getItem('boatName')) document.getElementById('boatName').value=localStorage.getItem('boatName');
        startGPS(); 
    };

</script>
</body>
</html>
